<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tailwind Admin Template</title>
    <meta name="author" content="David Grzyb">
    <meta name="description" content="Tailwind Admin Template for managing beds and tracking growth stages.">

    <!-- Tailwind -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css?family=Karla:400,700&display=swap');
        .font-family-karla { font-family: 'poppins', sans-serif; }
        .bg-sidebar { background: #1f272b; }
        .cta-btn { color: #000000; }
        .absolute {background: #099627;}
        .a:hover {background: #06641b;}
        .upgrade-btn:hover { background: #000000; }
        .active-nav-link { background: #15cc15; color: #ffffff; }
        .nav-item:hover { background: #15cc15; color: #ffffff; }
        .account-link:hover { background: #000000; }
        .custom-shadow { box-shadow: 0 4px 8px rgba(0, 29, 7, 0.849), 0 6px 20px rgba(0, 39, 2, 0.342);}
        .bg-bed-color {
            background-color: #86efac;
        }

        .bg-body{
            background: #1f272b
        }

        .text1 {
        color: #15cc15; /* Green color for "Matic" */
    }

    .text2 {
        color: #FFFF; /* Black color for "Hydro" */
    }

    .text-combined 
    {
        display: inline-block;
    
        font-weight: 700;
    }
      
      
        
    </style>
</head>
<body class=" font-family-karla flex bg-gray-300">

    <aside class="relative bg-sidebar h-screen w-96 hidden sm:block rounded-r-lg custom-shadow">
        
        <div class="p-6">
            <a href="index.html" class="text-5xl uppercase font-family-karla hover:text-green-100 text-combined">
                <span class="text2">Hydro</span><span class="text1">Matic</span>
            </a>
            
            
        </div>
        <nav class="text-white text-base font-semibold pt-3">
            <a href="index.html" class="flex items-center active-nav-link text-white py-4 pl-6 nav-item">
                <i class="fas fa-tachometer-alt  mr-3"></i>
                Dashboard
            </a>
            <a href="blank.html" class="flex items-center text-white opacity-75 hover:opacity-100 py-4 pl-6 nav-item">
                <i class="fas fa-sticky-note mr-3"></i>
                Blank Page
            </a>
            <a href="tables.html" class="flex items-center text-white opacity-75 hover:opacity-100 py-4 pl-6 nav-item">
                <i class="fas fa-table mr-3"></i>
                Tables
            </a>
            <a href="calendar.html" class="flex items-center text-white opacity-75 hover:opacity-100 py-4 pl-6 nav-item">
                <i class="fas fa-calendar mr-3"></i>
                Calendar
            </a>
        </nav>
    </aside>
    

    <div class="w-full flex flex-col h-screen overflow-y-hidden">
        <!-- Desktop Header -->
                                                                                                                                                                    
                                                                                                                                                                        
        <!-- Mobile Header & Nav -->
        <header class="w-full bg-sidebar py-5 px-6 sm:hidden">
            <div class="flex items-center justify-between">
                <a href="index.html" class="text-3xl font-bold uppercase font-family-karla hover:text-green-100 text-combined">
                    <span class="text2">Hydro</span><span class="text1">Matic</span>
                </a>
                <button id="mobile-menu-button" class="text-white text-3xl focus:outline-none">
                    <i class="fas fa-bars"></i>
                </button>
            </div>

            <!-- Mobile Nav -->
            <nav id="mobile-nav" class="flex flex-col pt-4">
                <a href="index.html" class="flex items-center active-nav-link text-white py-2 pl-4 nav-item">
                    <i class="fas fa-tachometer-alt mr-3 "></i>
                    Dashboard
                </a>
                <a href="blank.html" class="flex items-center text-white opacity-75 hover:opacity-100 py-2 pl-4 nav-item">
                    <i class="fas fa-sticky-note mr-3"></i>
                    Blank Page
                </a>
                <a href="tables.html" class="flex items-center text-white opacity-75 hover:opacity-100 py-2 pl-4 nav-item">
                    <i class="fas fa-table mr-3"></i>
                    Tables
                </a>
                <a href="calendar.html" class="flex items-center text-white opacity-75 hover:opacity-100 py-2 pl-4 nav-item">
                    <i class="fas fa-calendar mr-3"></i>
                    Calendar
                </a>
            </nav>
        </header>

 
    
        <div class="w-full overflow-x-hidden  flex flex-col">
            <main class="w-full flex-grow p-6">
                <h1 class="text-4xl text-white pb-6 font-bold">Dashboard</h1>

                <!-- Container for bed fields -->
                <div id="bedsContainer" class="flex flex-wrap gap-6">
                    <% bedsData.forEach(function(bed) { %>
                    <div class="bed w-80 rounded-lg shadow-lg p-6 min-w-[1000px] max-w-[1000px] bg-bed-color">
                        <h2 class="text-2xl font-semibold mb-4">Sensor ID: <%= bed.id %></h2>
                        
                        <label for="waterTemp<%= bed.id %>" class="block font-semibold text-sm text-gray-700 mt-4">Water Temperature: <%= bed.temperature %>°C</label>
                        
                        <label for="waterLevel<%= bed.id %>" class="block text-sm font-semibold text-gray-700 mt-4">Water Level: <%= bed.water_level %></label>
                        
                        <label for="day" class="block text-sm font-semibold text-gray-700 mt-4">Date: <%= bed.D_Date %></label>
                    
                        <label for="possibleImage" class="block text-sm font-semibold text-gray-700 mt-4">Time: <%= bed.T_Time %></label>  
                        
                        <h2 class="text-2xl font-semibold ">Maturity</h2>
                        <div class="flex ml-2 p-2 mt-2">
                            <img id="possibleImage<%= bed.id %>" src="http://localhost:3000/img/lettuce7.png" alt="Growth Stage Image" class="h-32 object-cover rounded" style="width: auto; height: 150px;">
                        </div>
                    
                        <label for="day" class="block text-sm font-semibold text-gray-700 mt-4">Sensor ID: <%= bed.id %></label>
                        
                        <!-- Delete Button -->
                        <button class="mt-4 text-red-600 hover:text-red-800 delete-bed-btn">
                            <i class="fas fa-trash-alt"></i> Delete Bed
                        </button>
                    </div>
                    <% }); %>
                </div>
                    
                </div>
            
                <div class="mt-4">
                    <button id="addBedBtn" class="w-80 h-12 bg-white cta-btn font-semibold py-2 mt-5 rounded-br-lg rounded-bl-lg rounded-tr-lg shadow-lg hover:shadow-xl hover:bg-gray-300 flex items-center justify-center">
                        <i class="fas fa-plus mr-3"></i>Add Bed
                    </button>
                </div>

                <div class="mt-8 w-full">
                    <h2 class="text-2xl text-white font-bold mb-4">Lettuce Growth Tracker</h2>
                    <div id="lettuceGrowthTracker" class="w-full grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-6 gap-5">
                        <!-- Growth stages will be dynamically injected here by JavaScript -->
                    </div>
                </div>
                
                <div class="mt-8 w-full">
                    <h2 class="text-2xl text-white font-bold mb-4">5-Day Weather Forecast</h2>
                    <div id="weather-forecast" class="w-full grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-6 gap-5">
                        <!-- Weather cards will be dynamically injected here by JavaScript -->
                    </div>
                </div>
                
                
            </main>
        </div>
    </div>

    <!-- AlpineJS -->
    <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>
    <!-- Font Awesome -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js" integrity="sha256-KzZiKy0DWYsnwMF+X1DvQngQ2/FxF7MF3Ff72XcpuPs=" crossorigin="anonymous"></script>
    <!-- SweetAlert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        const apiKey = 'eb138ac95057191159c149d24e2807a3';
        const city = 'Gapan';
        const weatherForecast = document.getElementById('weather-forecast');

        async function fetchWeatherData() {
            try {
                const response = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${city}&units=metric&cnt=40&appid=${apiKey}`);
                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json();
                const forecast = data.list;
                const dailyForecast = [];

                forecast.forEach((entry) => {
                    const date = new Date(entry.dt_txt).toDateString();
                    if (!dailyForecast.some(day => day.date === date)) {
                        dailyForecast.push({
                            date: date,
                            temp: entry.main.temp,
                            icon: `https://openweathermap.org/img/wn/${entry.weather[0].icon}@2x.png`,
                            description: entry.weather[0].description,
                            minTemp: entry.main.temp_min,
                            maxTemp: entry.main.temp_max
                        });
                    }
                    if (dailyForecast.length >= 5) return;
                });

                weatherForecast.innerHTML = ''; // Clear previous content
                dailyForecast.forEach((day) => {
                    const weatherCard = `
                        <div class="w-full bg-white md:w-54 mb-10 shadow-xl duration-500 ease-in-out transform  rounded-lg hover:scale-105 cursor-pointer  p-6">
                            <div class="text-md font-bold flex flex-col text-gray-900 ">
                                <span class="uppercase">${new Date(day.date).toLocaleDateString('en-US', { weekday: 'long' })}</span> 
                                <span class="font-normal text-gray-700 text-sm">${new Date(day.date).toLocaleDateString('en-US', { month: 'long', day: 'numeric' })}</span>
                            </div>
                            <div class="w-32 h-32 flex items-center justify-center">
                                <img src="${day.icon}" alt="Weather icon" class="w-32 h-32">
                            </div>
                            <p class="text-gray-700 mb-2">${day.description}</p>
                            <div class="text-2xl font-semibold text-gray-900 mb-6">${day.maxTemp.toFixed(1)}º<span class="font-normal text-gray-700 mx-1">/</span>${day.minTemp.toFixed(1)}º</div>
                        </div>
                    `;

                    weatherForecast.innerHTML += weatherCard;
                });
            } catch (error) {
                weatherForecast.innerHTML = '<p class="text-red-500 font-semibold">Unable to fetch weather data. Please try again later.</p>';
                console.error('Error fetching weather data:', error);
            }
        }

        fetchWeatherData();
    </script>
<script>
    document.addEventListener('DOMContentLoaded', async function () {
        const bedsContainer = document.getElementById('bedsContainer');

        // Function to update bed details
        function updateBedDetails(bedId, days, status, imageUrl) {
            const bedElement = document.querySelector(`#bed${bedId}`);
            
            if (bedElement) {
                bedElement.querySelector(`#days${bedId}`).textContent = days;
                bedElement.querySelector(`#possibleStatus${bedId}`).textContent = status;
                bedElement.querySelector(`#possibleImage${bedId}`).src = imageUrl;
            }
        }

        // Function to fetch bed data
        async function fetchBedData() {
            try {
                const response = await fetch('http://localhost:3000/api/beds'); // Replace with your actual API endpoint

                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                const beds = await response.json();

                // Update each bed with the fetched data
                beds.forEach(bed => {
                    const { id, days, status, imageUrl } = bed; // Adjust according to your API response
                    updateBedDetails(id, days, status, imageUrl);
                });
            } catch (error) {
                console.error('Error fetching bed data:', error);
            }
        }

        // Initialize the fetching of data
        fetchBedData();
    });
</script>
<script>
    document.getElementById('addBedBtn').addEventListener('click', function() {
        // Prompt user for sensor connection details
        Swal.fire({
            title: 'Sensor Connection',
            input: 'text',
            inputLabel: 'Enter Sensor ID or Connection Details',
            inputPlaceholder: 'Sensor ID',
            showCancelButton: true,
            confirmButtonText: 'Add Bed',
            cancelButtonText: 'Cancel',
            preConfirm: (sensorId) => {
                if (!sensorId) {
                    Swal.showValidationMessage('Please enter a valid sensor ID');
                }
                return sensorId;
            }
        }).then((result) => {
            if (result.isConfirmed) {
                // Show the processing swal
                Swal.fire({
                    title: 'Processing...',
                    text: 'Please wait while the sensor is being added.',
                    icon: 'info',
                    allowOutsideClick: false,
                    showConfirmButton: false,
                    timer: 2000 // Processing time in milliseconds
                }).then(() => {
                    // Simulate the process of adding the sensor
                    setTimeout(() => {
                        var bedsContainer = document.getElementById('bedsContainer');
                        var firstBed = bedsContainer.querySelector('.bed');
                        var newBed = firstBed.cloneNode(true); // Clone the first bed

                        // Update the bed count and header
                        var bedCount = bedsContainer.querySelectorAll('.bed').length + 1;
                        newBed.querySelector('h2').textContent = 'Bed ' + bedCount;

                        // Update the sensor connection details
                        newBed.querySelectorAll('input').forEach(function(input) {
                            if (input.id.includes('1')) {
                                input.id = input.id.replace(/1/, bedCount);
                                input.name = input.name.replace(/1/, bedCount);
                                input.value = ''; // Clear the value for new bed
                            }
                        });

                        // Remove any existing delete buttons to avoid duplicates
                        var existingDeleteBtn = newBed.querySelector('.delete-bed-btn');
                        if (existingDeleteBtn) {
                            existingDeleteBtn.remove();
                        }

                        // Create and add the delete button with confirmation
                        var deleteBtn = document.createElement('button');
                        deleteBtn.innerHTML = '<i class="fas fa-trash-alt"></i> Delete Bed';
                        deleteBtn.className = 'mt-4 text-red-600 hover:text-red-800 delete-bed-btn';
                        deleteBtn.addEventListener('click', function() {
                            Swal.fire({
                                title: 'Are you sure?',
                                text: "You won't be able to recover this bed!",
                                icon: 'warning',
                                showCancelButton: true,
                                confirmButtonText: 'Yes, delete it!',
                                cancelButtonText: 'No, keep it'
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    newBed.remove(); // Remove the bed section
                                    Swal.fire('Deleted!', 'The bed has been deleted.', 'success');
                                }
                            });
                        });

                        // Append the delete button to the new bed
                        newBed.appendChild(deleteBtn);

                        // Append the new bed to the container
                        bedsContainer.appendChild(newBed);

                        // Display success message
                        Swal.fire({
                            title: 'Success!',
                            text: 'Bed added successfully!',
                            icon: 'success',
                            confirmButtonText: 'OK'
                        });
                    }, 1000); // Simulated delay before showing success
                });
            }
        });
    });
</script>


  <script>
    document.addEventListener('DOMContentLoaded', async function () {
        const trackerContainer = document.getElementById('lettuceGrowthTracker');

        // Function to add a growth stage to the DOM
        function addGrowthStage(stage, description, imageIndex, start_day, end_day) {
            const stageElement = document.createElement('div');
            stageElement.classList.add('bg-white', 'rounded-lg', 'shadow-lg', 'p-6');
            const imageUrl = `http://localhost:3000/img/lettuce${imageIndex}.png`; // Incremental image URL
            stageElement.innerHTML = `
                <h3 class="text-lg font-semibold mb-4">${stage || 'Unknown Stage'}</h3>
                <h4 class="text-base font-semibold mb-4">${start_day} days to ${end_day} days</h4>
                <img src="${imageUrl}" alt="${stage || 'Stage Image'}" class="w-full h-32 object-cover rounded" style="height: 150px; width: auto;">
                <p>${description || 'No description available.'}</p>
            `;
            trackerContainer.appendChild(stageElement);
        }

        // Fetch the growth stages from the API
        async function fetchGrowthStages() {
            try {
                const response = await fetch('http://localhost:3000/api/growth-stages');

                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                const growthStages = await response.json();

                // Iterate over the growth stages and add them to the DOM
                growthStages.forEach((stage, index) => {
                    // Use image index incremented by 1, ensure it is between 1 and 7
                    const imageIndex = Math.min(index + 2, 7);
                    addGrowthStage(stage.phase_name, stage.description, imageIndex, stage.start_day, stage.end_day);
                });
            } catch (error) {
                console.error('Error fetching growth stages:', error);
                trackerContainer.innerHTML = '<p class="text-red-500 font-semibold">Unable to fetch data. Please try again later.</p>';
            }
        }

        // Initialize the fetching of data
        fetchGrowthStages();
    });
</script>

<script>
    // Toggle mobile menu visibility
    document.getElementById('mobile-menu-button').addEventListener('click', function() {
        const nav = document.getElementById('mobile-nav');
        nav.classList.toggle('hidden');
    });
</script>

    
</body>
</html>
